<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Alex Prime - Live Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .pulse { animation: pulse 2s infinite; }
        .pulse-fast { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .glow-green { box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
        .glow-yellow { box-shadow: 0 0 20px rgba(245, 158, 11, 0.4); }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body class="min-h-screen text-white p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                    ðŸŽ¯ Alex Prime Dashboard
                </h1>
                <p class="text-gray-400 mt-1 text-sm">Executive Director Agent â€¢ <span id="refresh-status" class="text-green-400">Live</span></p>
            </div>
            <div class="flex items-center gap-4">
                <!-- LIVE STATUS -->
                <div id="status-box" class="flex items-center gap-3 glass px-4 py-3 rounded-xl glow-green">
                    <div class="relative">
                        <span id="status-dot" class="w-4 h-4 bg-green-500 rounded-full block pulse-fast"></span>
                    </div>
                    <div>
                        <div id="status-text" class="font-semibold text-green-400">LOADING...</div>
                        <div id="current-task" class="text-xs text-gray-400 max-w-48 truncate">Connecting...</div>
                    </div>
                </div>
                <div class="text-right text-sm">
                    <div id="current-time" class="text-gray-300"></div>
                    <div id="last-update" class="text-gray-500 text-xs">--</div>
                    <div id="refresh-countdown" class="text-blue-400 font-mono text-xs">â†» --</div>
                </div>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-6">
            <div class="glass rounded-xl p-4 glow-blue">
                <div class="text-gray-400 text-xs">In Progress</div>
                <div class="text-2xl font-bold text-orange-400" id="stat-progress">-</div>
            </div>
            <div class="glass rounded-xl p-4">
                <div class="text-gray-400 text-xs">Pending</div>
                <div class="text-2xl font-bold text-yellow-400" id="stat-pending">-</div>
            </div>
            <div class="glass rounded-xl p-4">
                <div class="text-gray-400 text-xs">Completed</div>
                <div class="text-2xl font-bold text-green-400" id="stat-completed">-</div>
            </div>
            <div class="glass rounded-xl p-4">
                <div class="text-gray-400 text-xs">Tokens</div>
                <div class="text-2xl font-bold text-purple-400" id="stat-tokens">-</div>
            </div>
            <div class="glass rounded-xl p-4">
                <div class="text-gray-400 text-xs">Cost</div>
                <div class="text-2xl font-bold text-blue-400" id="stat-cost">-</div>
            </div>
            <div class="glass rounded-xl p-4">
                <div class="text-gray-400 text-xs">Heartbeat</div>
                <div class="text-lg font-bold text-cyan-400" id="stat-heartbeat">-</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Current Activity (2 cols) -->
            <div class="lg:col-span-2 glass rounded-xl p-5">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full blink"></span>
                    Current Activity
                </h2>
                <div id="current-activity" class="bg-gray-800/50 rounded-lg p-4">
                    <div class="text-gray-400">Loading...</div>
                </div>
                
                <h3 class="text-md font-semibold mt-5 mb-3 text-gray-300">Recent Actions</h3>
                <div id="recent-actions" class="space-y-2">
                    <div class="text-gray-500 text-sm">Loading...</div>
                </div>
            </div>

            <!-- Quick Info (1 col) -->
            <div class="glass rounded-xl p-5">
                <h2 class="text-lg font-semibold mb-4">âš¡ System Info</h2>
                <div class="space-y-3">
                    <div class="p-3 bg-gray-800/50 rounded-lg">
                        <div class="text-gray-400 text-xs">Agent</div>
                        <div id="info-agent" class="text-white font-medium">-</div>
                    </div>
                    <div class="p-3 bg-gray-800/50 rounded-lg">
                        <div class="text-gray-400 text-xs">Model</div>
                        <div id="info-model" class="text-purple-400 font-medium">-</div>
                    </div>
                    <div class="p-3 bg-gray-800/50 rounded-lg">
                        <div class="text-gray-400 text-xs">Session</div>
                        <div id="info-session" class="text-blue-400 font-medium">-</div>
                    </div>
                    <div class="p-3 bg-gray-800/50 rounded-lg">
                        <div class="text-gray-400 text-xs">Last Heartbeat</div>
                        <div id="info-heartbeat" class="text-cyan-400 font-medium">-</div>
                    </div>
                    <div class="p-3 bg-gray-800/50 rounded-lg">
                        <div class="text-gray-400 text-xs">Data Updated</div>
                        <div id="info-updated" class="text-gray-300 font-medium text-sm">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <!-- Pending Tasks -->
            <div class="glass rounded-xl p-5">
                <h2 class="text-lg font-semibold mb-4">ðŸŸ¡ Pending Tasks</h2>
                <div id="pending-tasks" class="space-y-2">
                    <div class="text-gray-500 text-sm">Loading...</div>
                </div>
            </div>

            <!-- Completed Tasks -->
            <div class="glass rounded-xl p-5">
                <h2 class="text-lg font-semibold mb-4">âœ… Completed</h2>
                <div id="completed-tasks" class="space-y-2 max-h-64 overflow-y-auto">
                    <div class="text-gray-500 text-sm">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm py-6 mt-6">
            Alex Prime Dashboard v4.0 â€¢ Auto-refresh every 10s â€¢ 
            <a href="https://github.com/ALEXPRIME000/alex-dashboard" class="text-blue-400 hover:underline">GitHub</a>
        </footer>
    </div>

    <script>
        const REFRESH_INTERVAL = 10; // seconds
        let countdown = REFRESH_INTERVAL;
        let fetchCount = 0;

        // Update clock
        function updateClock() {
            document.getElementById('current-time').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Fetch status with cache busting
        async function fetchStatus() {
            const timestamp = Date.now();
            const url = `status.json?v=${timestamp}&r=${Math.random()}`;
            
            try {
                const res = await fetch(url, {
                    cache: 'no-store',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                if (!res.ok) throw new Error('Fetch failed');
                
                const data = await res.json();
                fetchCount++;
                updateDashboard(data);
                
                document.getElementById('refresh-status').textContent = 'Live âœ“';
                document.getElementById('refresh-status').className = 'text-green-400';
            } catch (e) {
                console.error('Fetch error:', e);
                document.getElementById('refresh-status').textContent = 'Offline';
                document.getElementById('refresh-status').className = 'text-red-400';
            }
            
            countdown = REFRESH_INTERVAL;
        }

        // Update all dashboard elements
        function updateDashboard(data) {
            // Status
            const isActive = data.status === 'active' || data.status === 'working';
            document.getElementById('status-text').textContent = data.status?.toUpperCase() || 'UNKNOWN';
            document.getElementById('status-text').className = isActive ? 'font-semibold text-green-400' : 'font-semibold text-yellow-400';
            document.getElementById('status-dot').className = isActive ? 'w-4 h-4 bg-green-500 rounded-full block pulse-fast' : 'w-4 h-4 bg-yellow-500 rounded-full block pulse';
            document.getElementById('status-box').className = isActive ? 'flex items-center gap-3 glass px-4 py-3 rounded-xl glow-green' : 'flex items-center gap-3 glass px-4 py-3 rounded-xl glow-yellow';
            
            // Current task
            document.getElementById('current-task').textContent = data.currentTask || 'Idle';
            document.getElementById('current-activity').innerHTML = `
                <div class="text-lg font-medium text-white">${data.currentTask || 'No active task'}</div>
                <div class="text-sm text-gray-400 mt-1">Status: ${data.status || 'unknown'}</div>
            `;

            // Stats
            if (data.stats) {
                document.getElementById('stat-progress').textContent = data.stats.tasksInProgress ?? '-';
                document.getElementById('stat-pending').textContent = data.stats.tasksPending ?? '-';
                document.getElementById('stat-completed').textContent = data.stats.tasksCompleted ?? '-';
                document.getElementById('stat-tokens').textContent = data.stats.tokensEstimated ? Math.round(data.stats.tokensEstimated / 1000) + 'K' : '-';
                document.getElementById('stat-cost').textContent = data.stats.costEstimated ? '$' + data.stats.costEstimated.toFixed(2) : '-';
            }

            // Heartbeat
            if (data.heartbeat?.lastCheck) {
                const hbTime = new Date(data.heartbeat.lastCheck).toLocaleTimeString();
                document.getElementById('stat-heartbeat').textContent = hbTime;
                document.getElementById('info-heartbeat').textContent = hbTime;
            }

            // Info panel
            document.getElementById('info-agent').textContent = data.agent || 'Alex Prime';
            document.getElementById('info-model').textContent = data.model || '-';
            document.getElementById('info-session').textContent = data.session || '-';
            
            if (data.lastUpdate) {
                const updateTime = new Date(data.lastUpdate);
                document.getElementById('info-updated').textContent = updateTime.toLocaleString();
                document.getElementById('last-update').textContent = 'Data: ' + updateTime.toLocaleTimeString();
            }

            // Recent actions
            if (data.recentActions?.length) {
                document.getElementById('recent-actions').innerHTML = data.recentActions.map((action, i) => `
                    <div class="flex items-center gap-3 p-2 bg-gray-800/30 rounded-lg text-sm">
                        <span class="w-1.5 h-1.5 bg-blue-500 rounded-full ${i === 0 ? 'blink' : ''}"></span>
                        <span class="text-gray-300">${action}</span>
                    </div>
                `).join('');
            }

            // Pending tasks
            if (data.pendingTasks?.length) {
                document.getElementById('pending-tasks').innerHTML = data.pendingTasks.map(task => `
                    <div class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg">
                        <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                        <span class="flex-1 text-gray-300">${task.name}</span>
                        <span class="text-xs px-2 py-1 rounded ${
                            task.priority === 'high' ? 'text-red-400 bg-red-900/30' :
                            task.priority === 'medium' ? 'text-yellow-400 bg-yellow-900/30' :
                            'text-gray-400 bg-gray-700/50'
                        }">${task.priority}</span>
                    </div>
                `).join('');
            } else {
                document.getElementById('pending-tasks').innerHTML = '<div class="text-gray-500 text-sm">No pending tasks</div>';
            }

            // Completed tasks
            if (data.completedTasks?.length) {
                document.getElementById('completed-tasks').innerHTML = data.completedTasks.map(task => `
                    <div class="flex items-center gap-3 p-3 bg-green-900/20 rounded-lg">
                        <span class="text-green-500">âœ“</span>
                        <span class="flex-1 text-gray-300">${task.name}</span>
                        <span class="text-xs text-gray-500">${task.date}</span>
                    </div>
                `).join('');
            } else {
                document.getElementById('completed-tasks').innerHTML = '<div class="text-gray-500 text-sm">No completed tasks</div>';
            }
        }

        // Countdown
        function updateCountdown() {
            document.getElementById('refresh-countdown').textContent = `â†» ${countdown}s`;
            countdown--;
            if (countdown < 0) {
                fetchStatus();
            }
        }

        // Start
        fetchStatus();
        setInterval(updateCountdown, 1000);
    </script>
</body>
</html>
